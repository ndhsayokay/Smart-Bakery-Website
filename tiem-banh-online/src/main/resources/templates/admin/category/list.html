<!DOCTYPE html>
<!-- Sử dụng layout admin -->
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/fragments/admin-layout}" lang="vi">
<head>
    <title>Danh Sách Danh Mục</title> <!-- Title cho trang -->
</head>
<body>
    <!-- Nội dung chính của trang -->
    <div layout:fragment="content">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="h3">Quản Lý Danh Mục</h1>
            <a th:href="@{/admin/categories/add}" class="btn btn-primary btn-sm">
                <i class="bi bi-plus-circle me-1"></i> Thêm Danh Mục Mới
            </a>
        </div>

        <!-- Hiển thị thông báo thành công/lỗi -->
        <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${successMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${errorMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <div class="card">
            <div class="card-body">
                 <div th:if="${categoryPage == null or categoryPage.empty}" class="alert alert-info">Chưa có danh mục nào.</div>

                 <div th:unless="${categoryPage == null or categoryPage.empty}">
                     <div class="table-responsive">
                         <table class="table table-striped table-hover table-bordered align-middle">
                            <thead class="table-dark">
                                <tr>
                                    <!-- Sorting Links -->
                                    <th scope="col" style="width: 10%;">
                                        <a class="text-white text-decoration-none" th:href="@{/admin/categories(size=${categoryPage.size}, sort='categoryId,' + ${sortField == 'categoryId' ? reverseSortDir : 'asc'})}">
                                            ID <i th:classappend="${sortField == 'categoryId' ? (sortDir == 'ASC' ? 'bi-sort-up' : 'bi-sort-down') : 'bi-filter'}"></i>
                                        </a>
                                    </th>
                                    <th scope="col" style="width: 30%;">
                                         <a class="text-white text-decoration-none" th:href="@{/admin/categories(size=${categoryPage.size}, sort='name,' + ${sortField == 'name' ? reverseSortDir : 'asc'})}">
                                            Tên Danh Mục <i th:classappend="${sortField == 'name' ? (sortDir == 'ASC' ? 'bi-sort-up' : 'bi-sort-down') : 'bi-filter'}"></i>
                                        </a>
                                    </th>
                                    <th scope="col" style="width: 30%;">
                                        <a class="text-white text-decoration-none" th:href="@{/admin/categories(size=${categoryPage.size}, sort='name,' + ${sortField == 'name' ? reverseSortDir : 'asc'})}">
                                            Name <i th:classappend="${sortField == 'name' ? (sortDir == 'ASC' ? 'bi-sort-up' : 'bi-sort-down') : 'bi-filter'}"></i>
                                        </a>
                                    </th>
                                    <th scope="col" style="width: 15%;">Mô Tả Ngắn</th>
                                    <th scope="col" style="width: 15%;" class="text-center">Hành Động</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="category : ${categoryPage.content}">
                                    <td th:text="${category.categoryId}">1</td>
                                    <td th:text="${category.name}">Category Name</td>
                                    <td th:text="${category.name}">category-name</td>
                                    <!-- Hiển thị mô tả ngắn gọn -->
                                    <td th:text="${#strings.abbreviate(category.description, 50)}">Short description...</td>
                                    <td class="text-center">
                                        <a th:href="@{/admin/categories/edit/{id}(id=${category.categoryId})}" class="btn btn-sm btn-outline-primary me-1" title="Sửa">
                                            <i class="bi bi-pencil-square"></i>
                                        </a>
                                        <!-- Delete Form -->
                                        <form th:action="@{/admin/categories/delete/{id}(id=${category.categoryId})}" method="post" class="d-inline" onsubmit="return confirm('Bạn chắc chắn muốn xóa danh mục này? Việc này có thể ảnh hưởng đến các sản phẩm thuộc danh mục.');">
                                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                            <button type="submit" class="btn btn-sm btn-outline-danger" title="Xóa">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                     </div><!-- end table-responsive -->

                    <!-- Phân trang -->
                     <nav aria-label="Category navigation" th:if="${categoryPage.totalPages > 1}">
                        <ul class="pagination justify-content-center mt-3">
                            <!-- Previous Button -->
                            <li class="page-item" th:classappend="${categoryPage.first} ? 'disabled'">
                                <a class="page-link" th:href="@{/admin/categories(page=${categoryPage.number - 1}, size=${categoryPage.size}, sort=${sort})}">«</a>
                            </li>
                            <!-- Page Numbers -->
                             <li class="page-item" th:each="i : ${#numbers.sequence(0, categoryPage.totalPages - 1)}" th:classappend="${i == categoryPage.number} ? 'active'">
                                <a class="page-link" th:href="@{/admin/categories(page=${i}, size=${categoryPage.size}, sort=${sort})}" th:text="${i + 1}">1</a>
                            </li>
                            <!-- Next Button -->
                             <li class="page-item" th:classappend="${categoryPage.last} ? 'disabled'">
                                <a class="page-link" th:href="@{/admin/categories(page=${categoryPage.number + 1}, size=${categoryPage.size}, sort=${sort})}">»</a>
                            </li>
                        </ul>
                    </nav>
                 </div> <!-- end unless empty -->
            </div><!-- end card-body -->
        </div><!-- end card -->
    </div><!-- end layout fragment -->
</body>
</html>