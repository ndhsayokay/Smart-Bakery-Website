<!DOCTYPE html>
<!-- Kế thừa layout admin -->
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security6"
      layout:decorate="~{admin/fragments/admin-layout}" lang="vi">
<head>
    <title>Quản Lý Người Dùng</title>
</head>
<body>
    <!-- Phần nội dung chính -->
    <div layout:fragment="content">
        <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
            <h1 class="h2">Danh Sách Người Dùng</h1>
            <!-- Có thể thêm nút "Thêm Người Dùng" ở đây nếu cần -->
            <!-- <a th:href="@{/admin/users/add}" class="btn btn-primary btn-sm">
                <i class="bi bi-plus-circle me-1"></i> Thêm Người Dùng
            </a> -->
        </div>

        <!-- Thông báo (nếu có) -->
        <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${successMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${errorMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <!-- Bảng danh sách người dùng -->
        <div class="card shadow-sm">
            <div class="card-body">
                 <div th:if="${userPage == null or userPage.empty}" class="alert alert-info mb-0">Chưa có người dùng nào.</div>

                 <div class="table-responsive" th:unless="${userPage == null or userPage.empty}">
                     <table class="table table-striped table-hover table-bordered align-middle small">
                        <thead class="table-light">
                            <tr>
                                <!-- Link Sắp xếp -->
                                <th scope="col">
                                    <a class="text-dark fw-semibold text-decoration-none" th:href="@{/admin/users(size=${userPage.size}, sort='userId,' + ${sortField == 'userId' ? reverseSortDir : 'asc'})}">
                                        ID <i th:classappend="${sortField == 'userId' ? 'bi-sort-' + (sortDir == 'ASC' ? 'up' : 'down') : 'bi-filter-left'}"></i>
                                    </a>
                                </th>
                                <th scope="col">
                                     <a class="text-dark fw-semibold text-decoration-none" th:href="@{/admin/users(size=${userPage.size}, sort='email,' + ${sortField == 'email' ? reverseSortDir : 'asc'})}">
                                        Email <i th:classappend="${sortField == 'email' ? 'bi-sort-' + (sortDir == 'ASC' ? 'up' : 'down') : 'bi-filter-left'}"></i>
                                    </a>
                                </th>
                                <th scope="col">
                                     <a class="text-dark fw-semibold text-decoration-none" th:href="@{/admin/users(size=${userPage.size}, sort='fullName,' + ${sortField == 'fullName' ? reverseSortDir : 'asc'})}">
                                        Họ Tên <i th:classappend="${sortField == 'fullName' ? 'bi-sort-' + (sortDir == 'ASC' ? 'up' : 'down') : 'bi-filter-left'}"></i>
                                    </a>
                                </th>
                                <th scope="col">Điện Thoại</th>
                                <th scope="col">
                                    <a class="text-dark fw-semibold text-decoration-none" th:href="@{/admin/users(size=${userPage.size}, sort='role.roleName,' + ${sortField == 'role.roleName' ? reverseSortDir : 'asc'})}">
                                        Vai trò <i th:classappend="${sortField == 'role.roleName' ? 'bi-sort-' + (sortDir == 'ASC' ? 'up' : 'down') : 'bi-filter-left'}"></i>
                                    </a>
                                </th>
                                <th scope="col" class="text-center">
                                     <a class="text-dark fw-semibold text-decoration-none" th:href="@{/admin/users(size=${userPage.size}, sort='createdAt,' + ${sortField == 'createdAt' ? reverseSortDir : 'asc'})}">
                                        Ngày Tạo <i th:classappend="${sortField == 'createdAt' ? 'bi-sort-' + (sortDir == 'ASC' ? 'up' : 'down') : 'bi-filter-left'}"></i>
                                    </a>
                                </th>
                                <th scope="col" class="text-center">Hành Động</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Lặp qua danh sách user -->
                            <tr th:each="user : ${userPage.content}">
                                <td th:text="${user.userId}">1</td>
                                <td th:text="${user.email}">user@example.com</td>
                                <td th:text="${user.fullName ?: '(Chưa cập nhật)'}">User Name</td>
                                <td th:text="${user.phoneNumber ?: '(Chưa có)'}">09...</td>
                                <!-- Sử dụng safe navigation cho role -->
                                <td>
                                    <span th:if="${user.role?.roleName == 'ADMIN'}" class="badge text-bg-danger" th:text="${user.role.roleName}">ADMIN</span>
                                    <span th:unless="${user.role?.roleName == 'ADMIN'}" class="badge text-bg-secondary" th:text="${user.role?.roleName ?: '(Chưa có)'}">CUSTOMER</span>
                                </td>
                                <td class="text-center text-nowrap" th:text="${user.createdAt != null ? #temporals.format(user.createdAt, 'dd/MM/yyyy HH:mm') : ''}">Date</td>
                                <td class="text-center text-nowrap">
                                    <!-- Các nút hành động (Ví dụ) -->
                                    <a href="#" class="btn btn-sm btn-outline-info py-0 px-1 me-1" title="Xem chi tiết (Chưa làm)">
                                        <i class="bi bi-eye-fill"></i>
                                    </a>
                                    <a href="#" class="btn btn-sm btn-outline-warning py-0 px-1 me-1" title="Sửa vai trò (Chưa làm)">
                                        <i class="bi bi-person-gear"></i>
                                    </a>
                                    <!-- Nút Khóa/Mở khóa (Ví dụ) -->
                                    <!-- <form th:action="@{/admin/users/toggle-status/{id}(id=${user.userId})}" method="post" class="d-inline" onsubmit="return confirm('Thay đổi trạng thái người dùng?');">
                                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                        <button type="submit" class="btn btn-sm btn-outline-secondary py-0 px-1" title="Khóa/Mở khóa">
                                            <i class="bi bi-toggle-on"></i> / <i class="bi bi-toggle-off"></i>
                                        </button>
                                    </form> -->
                                </td>
                            </tr>
                        </tbody>
                    </table>
                 </div><!-- end table-responsive -->

                <!-- Phân trang -->
                 <nav aria-label="User navigation" th:if="${userPage != null and userPage.totalPages > 1}">
                    <ul class="pagination pagination-sm justify-content-center mt-3">
                         <!-- Nút về trang trước -->
                        <li class="page-item" th:classappend="${userPage.first} ? 'disabled'">
                            <a class="page-link" th:href="@{/admin/users(page=${userPage.number - 1}, size=${userPage.size}, sort=${sort})}">«</a>
                        </li>
                         <!-- Các nút số trang -->
                        <li class="page-item" th:each="i : ${#numbers.sequence(0, userPage.totalPages - 1)}" th:classappend="${i == userPage.number} ? 'active'">
                            <a class="page-link" th:href="@{/admin/users(page=${i}, size=${userPage.size}, sort=${sort})}" th:text="${i + 1}"></a>
                        </li>
                         <!-- Nút đến trang sau -->
                        <li class="page-item" th:classappend="${userPage.last} ? 'disabled'">
                            <a class="page-link" th:href="@{/admin/users(page=${userPage.number + 1}, size=${userPage.size}, sort=${sort})}">»</a>
                        </li>
                    </ul>
                </nav>
                 </div> <!-- end unless empty -->
            </div><!-- end card-body -->
        </div><!-- end card -->
    </div><!-- end layout fragment -->
</body>
</html>